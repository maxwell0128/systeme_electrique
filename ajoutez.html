<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Télécharger Contact vCard</title>
</head>
<body>
    <button id="download">Télécharger vCard</button>

    <script>
        'use strict';
        const fileEl = document.getElementById('file');
        const previewEl = document.getElementById('preview');
        const downloadEl = document.getElementById('download');

        function downloadToFile(content, filename, contentType) {
            const a = document.createElement('a');
            const file = new Blob([content], { type: contentType });

            a.href = URL.createObjectURL(file);
            a.download = filename;
            a.click();

            URL.revokeObjectURL(a.href);
        }

        function previewFile(event) {
            let reader = new FileReader();
            let file = event.target.files[0];

            reader.readAsDataURL(file);
            reader.onloadend = () => {
                previewEl.src = reader.result;
                previewEl.style.display = 'block';
            };
        }

        const makeVCardVersion = () => `VERSION:3.0`;
        const makeVCardInfo = (info) => `N;CHARSET=UTF-8:${info}`;
        const makeVCardName = (name) => `FN;CHARSET=UTF-8:${name}`;
        const makeVCardOrg = (org) => `ORG;CHARSET=UTF-8:${org}`;
        const makeVCardTitle = (title) => title ? `TITLE:${title}` : '';
        const makeVCardPhoto = (img) => img ? `PHOTO;TYPE=JPEG;ENCODING=b:${img}` : '';
        const makeVCardTel = (phone, type) => `TEL;type=${type}:${phone}`;
        const makeVCardAdr = (address) => `ADR;CHARSET=UTF-8:;;${address};;;;`;
        const makeVCardEmail = (email) => `EMAIL;CHARSET=UTF-8;WORK;INTERNET:${email}`;
        const makeVCardUrl = (url) => `item1.URL:${url}`;
        const makeVCardLabel = (label) => `item1.X-ABLabel;CHARSET=UTF-8:${label}`;
        const makeVCardTimeStamp = () => `REV:${new Date().toISOString()}`;

        function makeVCard() {
            let vcard = `BEGIN:VCARD
${makeVCardVersion()}
${makeVCardInfo(cardInfoEl.value)}
${makeVCardName("Franck Michaël AKOÏ")}
${makeVCardOrg("System Electrique")}
${makeVCardPhoto(previewEl.src)}
${makeVCardTel('+225 07 68 242 541', 'CELL;type=pref')}
${makeVCardTel('+225 01 72 038 891', 'WORK')}
${makeVCardAdr("ABIDJAN Rue i86")}
${makeVCardEmail("systemelectrique225@mail.com")}
${makeVCardUrl("https://systemeelectrique.netlify.app/")}
${makeVCardLabel("My Website")}
${makeVCardTimeStamp()}
END:VCARD`;
            downloadToFile(vcard, 'Franck_Michaël_contact.vcf', 'text/vcard');
        }

        downloadEl.addEventListener('click', makeVCard);
        fileEl.addEventListener('change', previewFile);
    </script>
</body>
</html>
